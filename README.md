# FortranTestGenerator

`FortranTestGenerator` (FTG) is a tool for automatically generating unit tests for subroutines of existing Fortran applications based on an approach called Capture & Replay.

One of the main effort for creating unit tests is the set-up of consistent input data. When working with legacy code, we can make use of the existing infrastructure and extract test data from the running application. 
FTG generates code for serializing and storing a subroutines input data and inserts this code temporarily into the subroutine (capture code).
In addition, FTG generates a basic test driver which loads this data and runs the subroutine (replay code). 
Meaningful checks and test data modification needs to be added by the developer.
All the code generated by FTG is based on customizable templates. So you are able to adapt it to your software environment.

FTG is written in Python and the principles of FTG are described in the following paper:

> C. Hovy and J. Kunkel, "Towards Automatic and Flexible Unit Test Generation for Legacy HPC Code," *2016 Fourth International Workshop on Software Engineering for High Performance Computing in Computational Science and Engineering (SE-HPCCSE)*, Salt Lake City, UT, 2016, pp. 1-8.
> http://dx.doi.org/10.1109/SE-HPCCSE.2016.005

So far, the documentation is very poor. If your interested in using `FortranTestGenerator`, please feel free to contact me:   
Christian Hovy <<hovy@informatik.uni-hamburg.de>>

## In general it works as follows

1. You identify an existing subroutine in your Fortran application and a certain execution of this subroutine that you want to run for test purposes in isolation, that is without the surrounding application.

2. You run FTG to insert the capture code into the subroutine. This code is responsible for storing all input variables to you hard drive when the capturing is active. Thanks to a built-in static source code analysis, only those variable are captured that are actually needed by the subroutine or by one of its directly or indirectly called routines.

3. Then you define the event on which the capturing should take place. By default, it's the first execution of the subroutine.

4. You compile and run your application with the capture code.

5. You run FTG to create the replay code, that means a basis test driver which loads the captured data and calls the subroutine by passing the captured data as input.

Variables that are considered to be input data:
* Arguments of intrisic types
* Components of derived type arguments that are actually used by the subroutine
* Module variables of the same module or imported by USE statements that are actually used by the subroutine

## Prerequisites 

To run FTG, you will need the following software packages:

* `Python 2.7` (Python 3+ is currently not supported, but all uncompatible stuff will be removed in the future)
* The `Cheetah Template Engine`: https://github.com/cheetahtemplate/cheetah (Unfortunately, development and support here has stopped during the development of FTG, but there is now a fork on: https://github.com/CheetahTemplate3/cheetah3, which has not yet been tested with FTG though.)
* This modified version of the `SerialBox` library: https://github.com/chovy1/serialbox
* `FortranCallgraph`: https://github.com/chovy1/fortrancallgraph

## Quick Start Guide

#### 1. Get and install `SerialBox`
... from here: https://github.com/chovy1/serialbox and learn how to built your application with it. 

#### 2. Get and install the `Cheetah Template Engine`
...from here: https://github.com/cheetahtemplate/cheetah or here: https://github.com/CheetahTemplate3/cheetah3 or just look if your OS provides a package (e.g. Ubuntu does).

#### 3. Get `FortranCallgraph` 
...from here: https://github.com/chovy1/fortrancallgraph

#### 4. Configure and try `FortranCallgraph`
...according to its [documentation](https://github.com/chovy1/fortrancallgraph/blob/master/README.md).

#### 5. Clone this repo

```
$> git clone https://github.com/chovy1/fortrantestgenerator.git
$> cd fortrantestgenerator
```

#### 6. Fill out the configuration file [config_fortrantestgenerator.py](config_fortrantestgenerator.py)

`FTG_DIR` : The location of FortranTestGenerator (usually `os.path.dirname(os.path.realpath(__file__))`)

`FCG_DIR` : The location of FortranCallgraph (usually `FTG_DIR + '../fortrancallgraph'')

`TEMPLATE_DIR` : The location of the templates to be used for code generation (`FTG_DIR + '/templates/standalone_nompi'` shall be a good start, or `FTG_DIR + '/templates/standalone'` if your application uses MPI)

`TEST_SOURCE_DIR` : The folder where the generated test driver shall be put in.

'TEST_DATA_BASE_DIR' : The folder where the captured data shall be put in.

**Please note:** If you don't want to have the configuration spread over the two files of FortranCallgraph and FortranTestGenerator, you can put all the variables from config_fortrancallgraph.py to config_fortrantestgenerator.py instead of importing them.

##### to be continued...

## License

[GNU General Public License v3.0](LICENSE)
