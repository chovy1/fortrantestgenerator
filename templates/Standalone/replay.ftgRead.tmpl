#set $var = $ftgRead_var
#if $var.dim > 4 or $var.type.upper().startswith('CHARACTER'):
  ! *** WARNING: Type not supported by serialbox *** 
  !     $var 
  !     $var.type, DIMENSION($var.dim)
#else 
  #if $var.referencable
    #set $d = 1
    #for $level in $var.levels[:-1]
      #set $container = $var.container($level)
      #set $contDim = $container.dim
      #if $needsAllocation($container)
        IF (ftg_field_exists("$container")) THEN
          ftg_bounds = ftg_get_bounds("$container")
          $alloc($container, $contDim, "ftg_bounds(1):ftg_bounds(2)", "ftg_bounds(3):ftg_bounds(4)", "ftg_bounds(5):ftg_bounds(6)", "ftg_bounds(7):ftg_bounds(8)")
        ELSE
          $alloc($container, $contDim, "0", "0", "0", "0")
        END IF
        #set $d = $d + $contDim
      #end if
    #end for
    #if $needsAllocation($var)
      #if $var.pointer
          CALL ftg_allocate_and_read_pointer("$var", $var)
      #else
          CALL ftg_allocate_and_read_allocatable("$var", $var)
      #end if
    #else
      CALL ftg_read("$var", $var)
    #end if
  #else
  
    #set $mandDims = $var.mandatoryDimensions
    #set $topContainer = $var
    #for $d in range(1, $mandDims + 1)
      #set $topContainer = $var.containerByDimension($d)
      #for $level in $topContainer.levels
        #set $container = $topContainer.container($level)
        #set $contDim = $container.dim
        #if $needsAllocation($container)
          $writeVarNameWithFilledIndicesToString($container, "ftg_c", $d - 1, "ftg_d1", "ftg_d2", "ftg_d3", "ftg_d4")
          IF (ftg_field_exists(ftg_c)) THEN
            ftg_bounds = ftg_get_bounds(ftg_c)
            $alloc($container, $contDim, "ftg_bounds(1):ftg_bounds(2)", "ftg_bounds(3):ftg_bounds(4)", "ftg_bounds(5):ftg_bounds(6)", "ftg_bounds(7):ftg_bounds(8)")
          ELSE
            $alloc($container, $contDim, "0", "0", "0", "0")
          END IF
        #end if
      #end for
      DO ftg_d$d = $lbound($var, $d, "ftg_d1", "ftg_d2", "ftg_d3", "ftg_d4"), $ubound($var, $d, "ftg_d1", "ftg_d2", "ftg_d3", "ftg_d4")
    #end for
    #for $level in sorted(set($var.levels[:-1]) - set($topContainer.levels))
      #set $container = $var.container($level)
      #set $contDim = $container.dim
      #if $needsAllocationFilled($container, $d, "ftg_d1", "ftg_d2", "ftg_d3", "ftg_d4")
        $writeVarNameWithFilledIndicesToString($container, "ftg_c", $d, "ftg_d1", "ftg_d2", "ftg_d3", "ftg_d4")
        #set $container = $fillIndices($container, $d, "ftg_d1", "ftg_d2", "ftg_d3", "ftg_d4")
        IF (ftg_field_exists(ftg_c)) THEN
          ftg_bounds = ftg_get_bounds(ftg_c)
          $alloc($container, $contDim, "ftg_bounds(1):ftg_bounds(2)", "ftg_bounds(3):ftg_bounds(4)", "ftg_bounds(5):ftg_bounds(6)", "ftg_bounds(7):ftg_bounds(8)")
        ELSE
          $alloc($container, $contDim, "0", "0", "0", "0")
        END IF
      #end if
    #end for
    $writeVarNameWithFilledIndicesToString($var, "ftg_c", $mandDims, "ftg_d1", "ftg_d2", "ftg_d3", "ftg_d4")
    #set $filled = $fillIndices($var, $mandDims, "ftg_d1", "ftg_d2", "ftg_d3", "ftg_d4")
    #if $var.pointer
      CALL ftg_allocate_and_read_pointer(ftg_c, $filled)
    #else if $var.allocatable
      CALL ftg_allocate_and_read_allocatable(ftg_c, $filled)
    #else
      CALL ftg_read(ftg_c, $filled)
    #end if 
    #for $d in range(1, $var.mandatoryDimensions + 1)
      END DO
    #end for
  #end if
#end if